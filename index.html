<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UX-OPS DASH 2025</title>
    <!-- External Libraries (CDNs) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        /* --- CSS VARIABLES & RESET --- */
        :root {
            --brand-yellow: #FFD400;
            --brand-blue: #00A9E0;
            --brand-red: #FA0050;
            --bg-dark: #0f1115;
            --bg-panel: #1e2025;
            --border: #2a2d35;
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            overflow: hidden;
        }

        /* --- LAYOUT --- */
        .sidebar {
            width: 260px;
            background-color: var(--bg-panel);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            transition: width 0.3s ease;
            z-index: 20;
        }
        .sidebar.collapsed { width: 80px; }
        
        .main-content {
            flex: 1;
            overflow-y: auto;
            position: relative;
            background-color: var(--bg-dark);
        }

        /* --- COMPONENTS --- */
        .sidebar-header {
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--border);
        }
        .logo-area { display: flex; align-items: center; gap: 10px; }
        
        /* Updated Logo Styles */
        .logo-icon {
            width: 40px; /* Fixed width for icon container */
            height: 40px; /* Fixed height */
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden; /* Ensure image doesn't overflow */
        }
        
        .logo-text { font-weight: 800; font-size: 18px; letter-spacing: 1px; color: #fff; }
        .sidebar.collapsed .logo-text { display: none; }
        
        .nav-btn {
            width: 100%;
            display: flex;
            align-items: center;
            padding: 12px 16px;
            margin-bottom: 4px;
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
            border-left: 4px solid transparent;
            font-size: 14px;
        }
        .nav-btn:hover { background-color: rgba(255,255,255,0.05); color: #fff; }
        .nav-btn.active {
            background-color: var(--border);
            color: var(--brand-red);
            border-left-color: var(--brand-red);
            font-weight: 600;
        }
        .nav-btn.active-main {
            background-color: var(--brand-red);
            color: white;
            border-left-color: transparent;
        }
        .nav-label { margin-left: 12px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .sidebar.collapsed .nav-label { display: none; }
        .sidebar-section-title {
            padding: 24px 16px 8px;
            font-size: 10px;
            font-weight: bold;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .sidebar.collapsed .sidebar-section-title { display: none; }

        .top-bar {
            position: sticky;
            top: 0;
            background-color: rgba(30, 32, 37, 0.95);
            backdrop-filter: blur(10px);
            z-index: 10;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
        }
        .page-title h2 { font-size: 24px; font-weight: 800; margin-bottom: 4px; }
        .page-title p { font-size: 13px; color: var(--text-muted); }

        .quarter-selector {
            display: flex;
            background-color: var(--bg-dark);
            padding: 4px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }
        .q-btn {
            padding: 6px 16px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 700;
            border: none;
            background: transparent;
            color: var(--text-muted);
            cursor: pointer;
        }
        .q-btn.active { background-color: var(--border); color: var(--brand-red); }

        .dashboard-grid { padding: 30px; }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }
        .stat-card {
            background-color: var(--bg-panel);
            border-radius: 12px;
            border: 1px solid var(--border);
            padding: 24px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        .stat-title { font-size: 12px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }
        .stat-value { font-size: 32px; font-weight: 800; color: #fff; margin: 8px 0 4px 0; }
        .stat-sub { font-size: 12px; color: #64748b; }
        .stat-icon { padding: 10px; border-radius: 8px; }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 24px;
        }
        .card {
            background-color: var(--bg-panel);
            border-radius: 12px;
            border: 1px solid var(--border);
            padding: 24px;
        }
        .card.span-2 { grid-column: span 2; }
        @media (max-width: 1000px) { .card.span-2 { grid-column: span 1; } }

        .card-header { display: flex; align-items: center; margin-bottom: 20px; }
        .accent-bar { width: 4px; height: 16px; background-color: var(--brand-red); margin-right: 10px; border-radius: 2px; }
        .card-title { font-size: 16px; font-weight: 700; color: #fff; }

        /* Table Styles */
        table { width: 100%; border-collapse: collapse; font-size: 13px; }
        th { text-align: left; padding: 16px 24px; color: var(--text-muted); text-transform: uppercase; font-size: 11px; font-weight: 700; background-color: var(--bg-panel); }
        td { padding: 16px 24px; border-top: 1px solid var(--border); color: #fff; }
        tr:hover { background-color: rgba(255,255,255,0.02); }
        
        .badge { padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: bold; border: 1px solid transparent; display: inline-block; }
        .badge-Done { background: rgba(16, 185, 129, 0.2); color: #34d399; border-color: rgba(16, 185, 129, 0.3); }
        .badge-WIP { background: rgba(255, 212, 0, 0.1); color: var(--brand-yellow); border-color: rgba(255, 212, 0, 0.2); }
        .badge-Todo { background: rgba(148, 163, 184, 0.2); color: #94a3b8; border-color: rgba(148, 163, 184, 0.3); }
        .badge-Nuevo { background: rgba(250, 0, 80, 0.15); color: var(--brand-red); border-color: rgba(250, 0, 80, 0.3); }
        .badge-Mejora { background: rgba(168, 85, 247, 0.15); color: #c084fc; border-color: rgba(168, 85, 247, 0.3); }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo-area">
                <div class="logo-icon">
                    <img src="FenixLogo.png" alt="Fenix Logo" style="width: 100%; height: 100%; object-fit: contain;">
                </div>
                <div class="logo-text">UX-OPS <span style="color: var(--brand-red);">DASH</span></div>
            </div>
            <button onclick="toggleSidebar()" style="background:none; border:none; color:var(--text-muted); cursor:pointer;">
                <i data-lucide="menu"></i>
            </button>
        </div>
        <nav style="padding: 16px; overflow-y: auto;">
            <!-- ID added for JS selection -->
            <button class="nav-btn active-main" id="btn-general" onclick="switchTab('Vista General')">
                <i data-lucide="layout-dashboard"></i>
                <span class="nav-label">Vista General</span>
            </button>

            <div class="sidebar-section-title">Equipos</div>
            <div id="team-nav-container">
                <!-- Team buttons injected by JS -->
            </div>

            <div class="sidebar-section-title">Data</div>
            <button class="nav-btn" onclick="switchTab('Base de Datos')" id="btn-db">
                <i data-lucide="database"></i>
                <span class="nav-label">Base de Datos</span>
            </button>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <div class="top-bar">
            <div class="page-title">
                <h2 id="page-title-text">Vista General</h2>
                <p id="page-subtitle-text">Performance Metrics & KPIs</p>
            </div>
            <div style="display: flex; align-items: center; gap: 20px;">
                <div class="quarter-selector" id="quarter-selector">
                    <button class="q-btn active" onclick="setQuarter('All')">All</button>
                    <button class="q-btn" onclick="setQuarter('Q1')">Q1</button>
                    <button class="q-btn" onclick="setQuarter('Q2')">Q2</button>
                    <button class="q-btn" onclick="setQuarter('Q3')">Q3</button>
                    <button class="q-btn" onclick="setQuarter('Q4')">Q4</button>
                </div>
                <div style="border-left: 1px solid var(--border); padding-left: 20px;">
                    <span style="font-size: 10px; color: #64748b; font-weight: 700; display: block; text-transform: uppercase;">Año Fiscal</span>
                    <span style="font-size: 18px; font-weight: 800; color: var(--brand-red);">2025</span>
                </div>
            </div>
        </div>

        <div class="dashboard-grid" id="dashboard-view">
            <!-- KPIs -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div>
                        <div class="stat-title">Total Proyectos</div>
                        <div class="stat-value" id="kpi-total">0</div>
                        <div class="stat-sub">En periodo seleccionado</div>
                    </div>
                    <div class="stat-icon" style="background: rgba(250, 0, 80, 0.2); color: var(--brand-red);"><i data-lucide="briefcase"></i></div>
                </div>
                <div class="stat-card">
                    <div>
                        <div class="stat-title">Tiempo Trabajado</div>
                        <div class="stat-value" id="kpi-hours">0 h</div>
                        <div class="stat-sub" id="kpi-avg">~0 h/proy</div>
                    </div>
                    <div class="stat-icon" style="background: rgba(0, 169, 224, 0.2); color: var(--brand-blue);"><i data-lucide="clock"></i></div>
                </div>
                <div class="stat-card">
                    <div>
                        <div class="stat-title">Completados</div>
                        <div class="stat-value" id="kpi-done">0</div>
                        <div class="stat-sub">Tasa de éxito</div>
                    </div>
                    <div class="stat-icon" style="background: rgba(16, 185, 129, 0.2); color: var(--success);"><i data-lucide="check-circle-2"></i></div>
                </div>
                <div class="stat-card">
                    <div>
                        <div class="stat-title">En Progreso</div>
                        <div class="stat-value" id="kpi-wip">0</div>
                        <div class="stat-sub">Bloqueados / Todo</div>
                    </div>
                    <div class="stat-icon" style="background: rgba(255, 212, 0, 0.2); color: var(--brand-yellow);"><i data-lucide="circle-dashed"></i></div>
                </div>
            </div>

            <!-- Charts -->
            <div class="charts-grid">
                <div class="card span-2">
                    <div class="card-header">
                        <div class="accent-bar"></div>
                        <div class="card-title" id="chart-main-title">Estado por Equipo</div>
                    </div>
                    <div style="height: 400px; position: relative;"> <!-- Increased height for horizontal layout -->
                        <canvas id="mainChart"></canvas>
                    </div>
                </div>
                
                <div style="display: flex; flexDirection: column; gap: 24px;">
                    <div class="card">
                        <div class="card-header">
                            <div class="accent-bar" style="background-color: #a855f7;"></div>
                            <div class="card-title">Naturaleza</div>
                        </div>
                        <div style="height: 200px; position: relative; display: flex; justify-content: center;">
                            <canvas id="donutChart"></canvas>
                        </div>
                    </div>
                    <div class="card" id="radar-container">
                        <div class="card-header">
                            <div class="accent-bar" style="background-color: var(--brand-blue);"></div>
                            <div class="card-title">Comparativa (Normalizada)</div>
                        </div>
                        <div style="height: 300px; position: relative; display: flex; justify-content: center;"> <!-- Increased height for radar -->
                            <canvas id="radarChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="dashboard-grid hidden" id="db-view">
            <div class="card">
                <div class="card-header">
                    <div class="accent-bar" style="background-color: var(--brand-blue);"></div>
                    <div class="card-title">Registro de Proyectos</div>
                </div>
                <div style="overflow-x: auto;">
                    <table id="db-table">
                        <thead>
                            <tr>
                                <th>Proyecto</th>
                                <th>Equipo</th>
                                <th>Quarter</th>
                                <th>Estado</th>
                                <th>Tipo</th>
                                <th>Tiempo</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Rows injected by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <script>
        // --- HELPER FUNCTIONS (Moved to top to prevent ReferenceError) ---
        const parseDuration = (str) => {
            if (!str) return 0;
            let hours = 0;
            const lower = str.toLowerCase();
            if (lower.includes('week')) hours += parseInt(lower.match(/(\d+)\s*week/)?.[1] || 0) * 40;
            if (lower.includes('day')) hours += parseInt(lower.match(/(\d+)\s*day/)?.[1] || 0) * 8;
            if (lower.includes('hour')) hours += parseInt(lower.match(/(\d+)\s*hour/)?.[1] || 0);
            return hours || 4;
        };

        const getQuarter = (dateStr) => {
            if (!dateStr) return "Q4"; 
            const monthMap = { 'ene': 0, 'feb': 1, 'mar': 2, 'abr': 3, 'may': 4, 'jun': 5, 'jul': 6, 'ago': 7, 'sep': 8, 'oct': 9, 'nov': 10, 'dic': 11 };
            const parts = dateStr.toLowerCase().split('/');
            const month = parts.length > 1 ? monthMap[parts[1]] : 9; // Default to Oct if parse fails
            if (month < 3) return "Q1";
            if (month < 6) return "Q2";
            if (month < 9) return "Q3";
            return "Q4";
        };

        // --- DATA & CONSTANTS ---
        const TEAMS = ["Martechs & Ads", "Onboarding", "Fulfillment", "Quick Commerce", "Plus & Pricing", "Payments", "Food"];
        
        // Raw Data
        const RAW_DATA = [
            { team: "Martechs & Ads", name: "[Mejora] Nuevo caso de uso en Priority Message", duration: "4 days", status: "Done", date: "07/mar/25", type: "Mejora" },
            { team: "Martechs & Ads", name: "[Mejora] Service Info", duration: "2 days", status: "Done", date: "17/mar/25", type: "Mejora" },
            { team: "Martechs & Ads", name: "[Mejora] High Value Actions", duration: "4 days", status: "Done", date: "31/mar/25", type: "Mejora" },
            { team: "Martechs & Ads", name: "[Mejora] Banner Autoplay", duration: "1 week", status: "Done", date: "24/abr/25", type: "Mejora" },
            { team: "Martechs & Ads", name: "[Mejora] Shoppable Banner", duration: "2 weeks", status: "Done", date: "02/jun/25", type: "Mejora" },
            { team: "Martechs & Ads", name: "[Mejora] Box Progress", duration: "1 day", status: "Done", date: "03/jul/25", type: "Mejora" },
            { team: "Martechs & Ads", name: "[Ajuste] Incentive Message S", duration: "1 day", status: "Done", date: "31/jul/25", type: "Mejora" },
            { team: "Martechs & Ads", name: "[Ajuste] Box Progress Indicator", duration: "1 day", status: "Done", date: "31/jul/25", type: "Mejora" },
            { team: "Martechs & Ads", name: "[Mejora] Tag M & S [Exclusive Deals]", duration: "4 days", status: "Done", date: "31/jul/25", type: "Mejora" },
            { team: "Martechs & Ads", name: "[Affordability] HO & Componentización", duration: "8 weeks", status: "Done", date: "22/ago/25", type: "Mejora" },
            { team: "Martechs & Ads", name: "[Mejora] Product Card S", duration: "3 days", status: "Done", date: "06/oct/25", type: "Mejora" },
            { team: "Onboarding", name: "[Mejora] Search Placeholder Dinámico", duration: "2 weeks", status: "Done", date: "23/abr/25", type: "Mejora" },
            { team: "Onboarding", name: "[Mejora] Home Hero Autoplay", duration: "1 week", status: "Done", date: "24/abr/25", type: "Mejora" },
            { team: "Onboarding", name: "[Mejora] Banner Autoplay", duration: "1 week", status: "Done", date: "24/abr/25", type: "Mejora" },
            { team: "Onboarding", name: "[Mejora] Home Hero", duration: "3 weeks", status: "Done", date: "21/may/25", type: "Mejora" },
            { team: "Onboarding", name: "[Mejora] Home Hero Agregar Prop Boolena CTA", duration: "1 day", status: "Done", date: "17/jun/25", type: "Mejora" },
            { team: "Plus & Pricing", name: "[Mejora] Rebrand & FOMO Plus", duration: "1 week", status: "Done", date: "12/feb/25", type: "Mejora" },
            { team: "Plus & Pricing", name: "[Mejora] Pricing en componentes (Sin Impuestos)", duration: "4 days", status: "Done", date: "25/mar/25", type: "Mejora" },
            { team: "Plus & Pricing", name: "[Ajuste] Banner Subscription; ajustar tamaño", duration: "4 hours", status: "Done", date: "31/mar/25", type: "Mejora" },
            { team: "Plus & Pricing", name: "[Mejora] Incentive Display", duration: "3 days", status: "Done", date: "14/abr/25", type: "Mejora" },
            { team: "Plus & Pricing", name: "[Mejora] Order Row", duration: "2 days", status: "Done", date: "03/jul/25", type: "Mejora" },
            { team: "Plus & Pricing", name: "[Mejora] Row Interactive M", duration: "0 hours", status: "Todo", date: "17/jul/25", type: "Mejora" },
            { team: "Plus & Pricing", name: "[Mejora] Plus (Segmented Control & Display)", duration: "1 day", status: "Done", date: "11/ago/25", type: "Mejora" },
            { team: "Plus & Pricing", name: "[Affordability] HO & Componentización", duration: "8 weeks", status: "Done", date: "22/ago/25", type: "Mejora" },
            { team: "Plus & Pricing", name: "[Assessment] Plus Home Auditoria", duration: "1 week", status: "Done", date: "22/sep/25", type: "Mejora" },
            { team: "Plus & Pricing", name: "[Mejora] Footer (Transición Individual Tag)", duration: "2 weeks", status: "WIP", date: "01/dic/25", type: "Mejora" },
            { team: "Fulfillment", name: "[Mejora] Order Progress Bar", duration: "3 days", status: "Done", date: "21/mar/25", type: "Mejora" },
            { team: "Fulfillment", name: "[Mejora] Order: cambio de Tag por Highlight", duration: "4 days", status: "Done", date: "31/mar/25", type: "Mejora" },
            { team: "Fulfillment", name: "[Ajuste] Order Card", duration: "1 week", status: "Done", date: "10/jul/25", type: "Mejora" },
            { team: "Fulfillment", name: "[Mejora] Componente compensaciones", duration: "2 days", status: "Done", date: "21/jul/25", type: "Mejora" },
            { team: "Fulfillment", name: "[Mejora] Live Activity (Iteraciones en PIN)", duration: "1 day", status: "Done", date: "28/jul/25", type: "Mejora" },
            { team: "Fulfillment", name: "[TBD] Wizard Page", duration: "1 day", status: "Done", date: "28/jul/25", type: "Mejora" },
            { team: "Fulfillment", name: "[Ajuste] Order Card & Live Activity", duration: "1 day", status: "Done", date: "08/sep/25", type: "Mejora" },
            { team: "Quick Commerce", name: "[Mejora] Chip S & M (Tag)", duration: "1 week", status: "Done", date: "12/feb/25", type: "Mejora" },
            { team: "Quick Commerce", name: "[Nuevo] Colecciones M", duration: "3 weeks", status: "Done", date: "21/mar/25", type: "Nuevo" },
            { team: "Quick Commerce", name: "[Nuevo] Iniciativa Variants (QC)", duration: "2 weeks", status: "Done", date: "21/mar/25", type: "Nuevo" },
            { team: "Quick Commerce", name: "[Mejora] Chip S (Tag)-Impacto en Librería", duration: "1 week", status: "Done", date: "21/mar/25", type: "Mejora" },
            { team: "Quick Commerce", name: "[Mejora] Pricing en componentes", duration: "4 days", status: "Done", date: "25/mar/25", type: "Mejora" },
            { team: "Quick Commerce", name: "[Mejora] Chip M (Tag) Impacto en Libreria", duration: "1 week", status: "Done", date: "28/mar/25", type: "Mejora" },
            { team: "Quick Commerce", name: "[Nuevo] Colecciones L", duration: "3 weeks", status: "Done", date: "14/abr/25", type: "Nuevo" },
            { team: "Quick Commerce", name: "[Mejora] Product Entry", duration: "2 weeks", status: "Done", date: "05/may/25", type: "Mejora" },
            { team: "Quick Commerce", name: "[Mejora] DoubleYa", duration: "2 weeks", status: "Done", date: "21/may/25", type: "Mejora" },
            { team: "Quick Commerce", name: "[Ajuste] Header Product Detail", duration: "3 days", status: "Done", date: "29/may/25", type: "Mejora" },
            { team: "Quick Commerce", name: "[Mejora] Chip Filter S", duration: "4 days", status: "Done", date: "18/jun/25", type: "Mejora" },
            { team: "Quick Commerce", name: "[Mejora] Row Informative L (DoubleYa)", duration: "2 days", status: "Done", date: "18/jun/25", type: "Mejora" },
            { team: "Quick Commerce", name: "[Mejora] Story Page (UFF)", duration: "2 days", status: "Done", date: "21/jul/25", type: "Mejora" },
            { team: "Quick Commerce", name: "[Ajuste] Product Header", duration: "1 day", status: "Done", date: "23/jul/25", type: "Mejora" },
            { team: "Quick Commerce", name: "[Mejora] Story Card (UFF)", duration: "2 days", status: "Done", date: "28/jul/25", type: "Mejora" },
            { team: "Quick Commerce", name: "[Ajuste] Product Description Pricing", duration: "1 day", status: "Done", date: "05/ago/25", type: "Mejora" },
            { team: "Quick Commerce", name: "[Mejora] Home Entry Point", duration: "4 days", status: "Done", date: "02/sep/25", type: "Mejora" },
            { team: "Quick Commerce", name: "[Mejora] Story Page", duration: "3 days", status: "Done", date: "15/sep/25", type: "Mejora" },
            { team: "Quick Commerce", name: "[Mejora] Box Message XS, S y M", duration: "2 days", status: "Done", date: "03/oct/25", type: "Mejora" },
            { team: "Quick Commerce", name: "[Mejora] Product Card S & M-QC Nuevos", duration: "1 week, 4 days", status: "Done", date: "13/oct/25", type: "Mejora" },
            { team: "Payments", name: "[Mejora] Incentive Row Voucher S", duration: "2 days", status: "Done", date: "03/jun/25", type: "Mejora" },
            { team: "Payments", name: "[Mejora] Row Informative M (Affordability)", duration: "1 day", status: "Done", date: "12/ago/25", type: "Mejora" },
            { team: "Payments", name: "[Ajuste] Box Interactive", duration: "3 days", status: "Done", date: "08/sep/25", type: "Mejora" },
            { team: "Food", name: "[Mejora] Pricing en componentes", duration: "4 days", status: "Done", date: "25/mar/25", type: "Mejora" },
            { team: "Food", name: "[Mejora] Reviews (More Reviews)", duration: "0 days", status: "Todo", date: "21/jul/25", type: "Mejora" },
            { team: "Food", name: "[Mejora] Story Card (Autoplay)", duration: "2 days", status: "Done", date: "21/jul/25", type: "Mejora" },
            { team: "Food", name: "[Ajuste] Rating", duration: "2 days", status: "Done", date: "22/ago/25", type: "Mejora" },
            { team: "Food", name: "[Mejora] Review Card L", duration: "2 days", status: "Done", date: "08/sep/25", type: "Mejora" },
            { team: "Food", name: "[Nuevo] Review Row L", duration: "1 day", status: "Done", date: "03/oct/25", type: "Nuevo" },
            { team: "Food", name: "[Nuevo] Review Row L & Review User Info", duration: "3 days", status: "Done", date: "03/oct/25", type: "Nuevo" },
            { team: "Food", name: "[TBD] Highlight Socios", duration: "0 days", status: "Todo", date: "06/oct/25", type: "Mejora" },
        ];

        // --- STATE ---
        let currentState = {
            tab: 'Vista General',
            quarter: 'All'
        };

        const processedData = RAW_DATA.map((item, i) => ({
            id: i,
            ...item,
            hours: parseDuration(item.duration),
            quarter: getQuarter(item.date)
        }));

        // --- RENDER LOGIC ---
        
        let mainChartInstance = null;
        let donutChartInstance = null;
        let radarChartInstance = null;

        function init() {
            lucide.createIcons();
            renderSidebar();
            updateDashboard();
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('collapsed');
        }

        function switchTab(tabName) {
            currentState.tab = tabName;
            updateDashboard();
        }

        function setQuarter(q) {
            currentState.quarter = q;
            updateDashboard();
        }

        function renderSidebar() {
            const container = document.getElementById('team-nav-container');
            container.innerHTML = TEAMS.map(team => `
                <button class="nav-btn" onclick="switchTab('${team}')" id="btn-${team.replace(/\s+/g, '')}">
                    <i data-lucide="users"></i>
                    <span class="nav-label">${team}</span>
                </button>
            `).join('');
            lucide.createIcons();
        }

        function updateDashboard() {
            // Update Tab Styling
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active', 'active-main');
                btn.style.color = ''; 
                btn.style.borderLeftColor = '';
            });

            let activeBtn;
            if (currentState.tab === 'Vista General') {
                activeBtn = document.getElementById('btn-general');
                if (activeBtn) activeBtn.classList.add('active-main');
            } else if (currentState.tab === 'Base de Datos') {
                activeBtn = document.getElementById('btn-db');
                if (activeBtn) activeBtn.classList.add('active');
            } else {
                const id = `btn-${currentState.tab.replace(/\s+/g, '')}`;
                activeBtn = document.getElementById(id);
                if (activeBtn) activeBtn.classList.add('active');
            }

            // Update Quarter Buttons
            document.querySelectorAll('.q-btn').forEach(btn => {
                btn.classList.toggle('active', btn.textContent === currentState.quarter);
            });

            // Update Titles
            document.getElementById('page-title-text').textContent = currentState.tab;
            document.getElementById('page-subtitle-text').textContent = currentState.tab === 'Base de Datos' 
                ? "Registro completo de todas las tareas" 
                : "Performance Metrics & KPIs";

            // View Switching
            const isDb = currentState.tab === 'Base de Datos';
            document.getElementById('dashboard-view').classList.toggle('hidden', isDb);
            document.getElementById('db-view').classList.toggle('hidden', !isDb);

            // Filter Data
            let activeData = processedData;
            if (!isDb && currentState.tab !== 'Vista General') {
                activeData = activeData.filter(p => p.team === currentState.tab);
            }
            if (currentState.quarter !== 'All') {
                activeData = activeData.filter(p => p.quarter === currentState.quarter);
            }

            if (isDb) {
                renderTable(activeData);
            } else {
                renderKPIs(activeData);
                renderCharts(activeData);
            }
        }

        function renderKPIs(data) {
            const total = data.length;
            const hours = data.reduce((sum, p) => sum + p.hours, 0);
            const done = data.filter(p => p.status === 'Done').length;
            const wip = data.filter(p => p.status === 'WIP').length;
            const todo = data.filter(p => p.status === 'Todo').length;

            document.getElementById('kpi-total').textContent = total;
            document.getElementById('kpi-hours').textContent = `${hours} h`;
            document.getElementById('kpi-avg').textContent = total ? `~${(hours/total).toFixed(1)} h/proy` : '0';
            document.getElementById('kpi-done').textContent = done;
            document.getElementById('kpi-wip').textContent = wip;
        }

        function renderTable(data) {
            const tbody = document.querySelector('#db-table tbody');
            tbody.innerHTML = data.map(p => `
                <tr>
                    <td>
                        <div style="font-weight:600; color:#fff;">${p.name}</div>
                        <div style="font-size:11px; color:#64748b;">${p.date}</div>
                    </td>
                    <td style="color:#94a3b8;">${p.team}</td>
                    <td><span style="padding:2px 8px; border-radius:4px; background:#0f1115; border:1px solid #2a2d35; color:#cbd5e1; font-size:11px; font-weight:700;">${p.quarter}</span></td>
                    <td><span class="badge badge-${p.status}">${p.status}</span></td>
                    <td><span class="badge badge-${p.type}">${p.type}</span></td>
                    <td style="font-family:monospace; color:#fff; font-weight:600;">${p.hours}h</td>
                </tr>
            `).join('');
        }

        function renderCharts(data) {
            Chart.defaults.color = '#94a3b8';
            Chart.defaults.font.family = '-apple-system, sans-serif';

            // --- MAIN BAR CHART (HORIZONTAL) ---
            const ctxMain = document.getElementById('mainChart').getContext('2d');
            if (mainChartInstance) mainChartInstance.destroy();

            const teams = TEAMS;
            // Short mapping for clean labels
            const shortNames = {
                "Martechs & Ads": "Martech",
                "Onboarding": "Onboarding",
                "Fulfillment": "Fulfillment",
                "Quick Commerce": "QC",
                "Plus & Pricing": "Plus",
                "Payments": "Payments",
                "Food": "Food"
            };

            const barData = currentState.tab === 'Vista General' 
                ? teams.map(t => {
                    const subset = data.filter(p => p.team === t);
                    return {
                        done: subset.filter(p => p.status === 'Done').length,
                        wip: subset.filter(p => p.status === 'WIP').length,
                        todo: subset.filter(p => p.status === 'Todo').length,
                    };
                })
                : [{
                    done: data.filter(p => p.status === 'Done').length,
                    wip: data.filter(p => p.status === 'WIP').length,
                    todo: data.filter(p => p.status === 'Todo').length,
                }];

            const labels = currentState.tab === 'Vista General' 
                ? teams.map(t => shortNames[t]) 
                : ['Estado Actual'];
            
            mainChartInstance = new Chart(ctxMain, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        { label: 'Done', data: barData.map(d => d.done), backgroundColor: '#10b981', borderRadius: 4 },
                        { label: 'WIP', data: barData.map(d => d.wip), backgroundColor: '#FFD400', borderRadius: 4 },
                        { label: 'Todo', data: barData.map(d => d.todo), backgroundColor: '#64748b', borderRadius: 4 }
                    ]
                },
                options: {
                    indexAxis: 'y', // Set horizontal
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { 
                            grid: { color: '#2a2d35' }, 
                            ticks: { color: '#94a3b8' },
                            stacked: true,
                            beginAtZero: true
                        },
                        y: { 
                            grid: { display: false }, 
                            ticks: { color: '#fff', font: { weight: 'bold' } }, 
                            stacked: true
                        }
                    },
                    plugins: { 
                        legend: { position: 'bottom', labels: { usePointStyle: true, padding: 20 } },
                        tooltip: {
                            backgroundColor: '#1e2025',
                            borderColor: '#2a2d35',
                            borderWidth: 1,
                            titleColor: '#fff',
                            bodyColor: '#cbd5e1',
                            padding: 12,
                            cornerRadius: 8
                        }
                    }
                }
            });

            // --- DONUT CHART ---
            const ctxDonut = document.getElementById('donutChart').getContext('2d');
            if (donutChartInstance) donutChartInstance.destroy();
            
            const nuevos = data.filter(p => p.type === 'Nuevo').length;
            const mejoras = data.filter(p => p.type === 'Mejora').length;

            donutChartInstance = new Chart(ctxDonut, {
                type: 'doughnut',
                data: {
                    labels: ['Nuevos', 'Mejoras'],
                    datasets: [{
                        data: [nuevos, mejoras],
                        backgroundColor: ['#FA0050', '#a855f7'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom', labels: { usePointStyle: true } } }
                }
            });

            // --- RADAR CHART (Only on General) ---
            const ctxRadar = document.getElementById('radarChart').getContext('2d');
            const radarContainer = document.getElementById('radar-container');
            
            if (currentState.tab !== 'Vista General') {
                radarContainer.classList.add('hidden');
            } else {
                radarContainer.classList.remove('hidden');
                if (radarChartInstance) radarChartInstance.destroy();

                const rawStats = teams.map(t => {
                    const subset = data.filter(p => p.team === t);
                    return {
                        team: shortNames[t],
                        count: subset.length,
                        hours: subset.reduce((s, x) => s + x.hours, 0)
                    };
                });

                // Normalization Logic to Fix "Small/Broken" Shape
                const maxCount = Math.max(...rawStats.map(d => d.count)) || 1;
                const maxHours = Math.max(...rawStats.map(d => d.hours)) || 1;

                const normalizedCount = rawStats.map(d => (d.count / maxCount) * 100);
                const normalizedHours = rawStats.map(d => (d.hours / maxHours) * 100);

                radarChartInstance = new Chart(ctxRadar, {
                    type: 'radar',
                    data: {
                        labels: teams.map(t => shortNames[t]),
                        datasets: [
                            { 
                                label: 'Volumen (Proyectos)', 
                                data: normalizedCount, 
                                borderColor: '#FA0050', 
                                backgroundColor: 'rgba(250, 0, 80, 0.4)', // Increased opacity
                                pointBackgroundColor: '#FA0050',
                                borderWidth: 2,
                                fill: true
                            },
                            { 
                                label: 'Esfuerzo (Horas)', 
                                data: normalizedHours, 
                                borderColor: '#00A9E0', 
                                backgroundColor: 'rgba(0, 169, 224, 0.2)',
                                pointBackgroundColor: '#00A9E0',
                                borderWidth: 2,
                                fill: true
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            r: {
                                min: 0,
                                max: 100, // Explicit 0-100 normalization scale
                                ticks: { display: false }, 
                                grid: { color: '#2a2d35' },
                                angleLines: { color: '#2a2d35' },
                                pointLabels: { color: '#94a3b8', font: { size: 12, weight: 'bold' } }
                            }
                        },
                        plugins: { 
                            legend: { display: true, position: 'bottom', labels: { boxWidth: 10, padding: 10, font: { size: 10 } } },
                            tooltip: {
                                backgroundColor: '#1e2025',
                                borderColor: '#FA0050',
                                borderWidth: 1,
                                padding: 12,
                                callbacks: {
                                    // Custom tooltip to show REAL values
                                    label: function(context) {
                                        const index = context.dataIndex;
                                        const rawItem = rawStats[index];
                                        if (context.datasetIndex === 0) {
                                            return `Proyectos: ${rawItem.count}`;
                                        } else {
                                            return `Horas: ${rawItem.hours}h`;
                                        }
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }

        // Init
        init();

    </script>
</body>
</html>
